# AIAutoBangumi2 ğŸŒ

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.68+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Docker](https://img.shields.io/badge/Docker-Ready-blue.svg)]()

**ä¸€ä¸ªæ™ºèƒ½çš„åŠ¨ç”»è‡ªåŠ¨ä¸‹è½½ä¸ç®¡ç†ç³»ç»Ÿï¼ŒåŸºäºAIæŠ€æœ¯çš„æ–°ä¸€ä»£ç•ªå‰§è¿½è¸ªå·¥å…·ã€‚**

AIAutoBangumi2 æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„åŠ¨ç”»è‡ªåŠ¨ä¸‹è½½ç³»ç»Ÿï¼Œé›†æˆäº†äººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œèƒ½å¤Ÿæ™ºèƒ½è¯†åˆ«å‰§é›†ä¿¡æ¯ã€è‡ªåŠ¨ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼ã€**åˆ›å»ºç¡¬é“¾æ¥**ï¼ˆä¸ä¼šå½±å“åŸæœ¬çš„ä¸‹è½½å™¨çš„åšç§ï¼‰å¹¶ä¸åª’ä½“åº“ç³»ç»Ÿæ— ç¼å¯¹æ¥ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸ¤– AI æ™ºèƒ½åŠŸèƒ½
- **æ™ºèƒ½æ ‡é¢˜æ¸…æ´—**: ä½¿ç”¨AIè‡ªåŠ¨æ¸…ç†å‘å¸ƒç»„æ ‡è¯†ã€ç”»è´¨æ ‡è®°ç­‰å†—ä½™ä¿¡æ¯
- **è‡ªåŠ¨å‰§é›†è¯†åˆ«**: AIæ™ºèƒ½æå–æ–‡ä»¶åä¸­çš„å‰§é›†ç¼–å·
- **æ™ºèƒ½æ­£åˆ™ç”Ÿæˆ**: æ ¹æ®RSSæºæˆ–ç§å­æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆå‰§é›†åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
- **æ–‡ä»¶é‡è¦æ€§åˆ¤æ–­**: AIæ™ºèƒ½åˆ¤æ–­å“ªäº›æ–‡ä»¶éœ€è¦ä¸‹è½½å’Œåˆ›å»ºç¡¬é“¾æ¥

### ğŸ“º åª’ä½“ç®¡ç†
- **å¤šæºæ”¯æŒ**: æ”¯æŒRSSæºå’Œç£åŠ›é“¾æ¥ä¸¤ç§ä¸‹è½½æº
- **æ™ºèƒ½ç¡¬é“¾æ¥**: è‡ªåŠ¨åˆ›å»ºç¬¦åˆåª’ä½“åº“æ ‡å‡†çš„ç¡¬é“¾æ¥ç»“æ„
- **TMDBé›†æˆ**: è‡ªåŠ¨ä»TMDBè·å–åª’ä½“ä¿¡æ¯å’Œå…ƒæ•°æ®
- **åˆ†å­£ç®¡ç†**: æ™ºèƒ½è¯†åˆ«å¹¶æŒ‰å­£åº¦ç»„ç»‡å‰§é›†æ–‡ä»¶

### ğŸ”„ è‡ªåŠ¨åŒ–å·¥ä½œæµ
- **å®šæ—¶ä»»åŠ¡**: è‡ªåŠ¨æ£€æŸ¥RSSæ›´æ–°å’Œç§å­ä¸‹è½½çŠ¶æ€
- **ä¸‹è½½ç®¡ç†**: ä¸qBittorrentæ— ç¼é›†æˆï¼Œè‡ªåŠ¨ç®¡ç†ä¸‹è½½ä»»åŠ¡
- **è¿›åº¦è¿½è¸ª**: å®æ—¶ç›‘æ§ä¸‹è½½è¿›åº¦å’Œæ–‡ä»¶å¤„ç†çŠ¶æ€
- **é”™è¯¯æ¢å¤**: æ™ºèƒ½é‡è¯•å¤±è´¥çš„ä»»åŠ¡

### ğŸ¨ ç°ä»£åŒ–ç•Œé¢
- **Vue.jså‰ç«¯**: å“åº”å¼Webç•Œé¢ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- **å®æ—¶æ›´æ–°**: åŠ¨æ€æ˜¾ç¤ºä¸‹è½½è¿›åº¦å’ŒçŠ¶æ€
- **ç”¨æˆ·æƒé™**: æ”¯æŒå¤šç”¨æˆ·å’Œç®¡ç†å‘˜æƒé™ç®¡ç†
- **RESTful API**: å®Œæ•´çš„APIæ¥å£ï¼Œæ”¯æŒç¬¬ä¸‰æ–¹é›†æˆ

### ğŸ†• æ–°å¢åŠŸèƒ½ (v2.0.0)
- **ğŸ“Š ç»Ÿè®¡åˆ†æ**: å…¨é¢çš„ç³»ç»Ÿç»Ÿè®¡å’Œæ•°æ®åˆ†æ
- **ğŸ·ï¸ æ ‡ç­¾ç®¡ç†**: ä¸ºæºæ·»åŠ æ ‡ç­¾ï¼Œæ›´å¥½åœ°ç»„ç»‡å’Œåˆ†ç±»
- **âš¡ æ‰¹é‡æ“ä½œ**: æ‰¹é‡ç®¡ç†ç§å­å’Œæºï¼Œæé«˜æ•ˆç‡
- **ğŸ’¾ å¤‡ä»½å¯¼å‡º**: è½»æ¾å¤‡ä»½å’Œæ¢å¤é…ç½®æ•°æ®
- **ğŸ” å¼ºå¤§æœç´¢**: å…¨å±€æœç´¢å’Œé«˜çº§è¿‡æ»¤åŠŸèƒ½
- **ğŸ“¢ é€šçŸ¥å¢å¼º**: å®Œæ•´çš„ Telegram å’Œé‚®ä»¶é€šçŸ¥æ”¯æŒ
- **ğŸ›¡ï¸ å®‰å…¨å¢å¼º**: é€Ÿç‡é™åˆ¶ã€å®‰å…¨å“åº”å¤´ã€è¯·æ±‚æ—¥å¿—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- qBittorrent 4.0+
- ç°ä»£æµè§ˆå™¨

### å®‰è£…éƒ¨ç½²

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/JeremyGuo/AIAutoBangumi2.git
cd AIAutoBangumi2
```

2. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

3. **é…ç½®ç³»ç»Ÿ**
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config.yaml.template config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano config.yaml
```

4. **åˆå§‹åŒ–æ•°æ®åº“**
```bash
# æ•°æ®åº“ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º
```

5. **å¯åŠ¨æœåŠ¡**
```bash
python main.py
```

6. **è®¿é—®ç³»ç»Ÿ**
   
   æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:8001`

### Docker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t aiautobangumi2 .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name aiautobangumi2 \
  -p 8001:8001 \
  -v /path/to/config:/app/config \
  -v /path/to/downloads:/downloads \
  -v /path/to/media:/media \
  aiautobangumi2
```

## âš™ï¸ é…ç½®è¯´æ˜

### æ ¸å¿ƒé…ç½®

```yaml
general:
  address: 0.0.0.0          # ç›‘å¬åœ°å€
  listen: 8001              # ç›‘å¬ç«¯å£
  secret_key: your_secret   # JWTå¯†é’¥
  http_proxy: ""            # HTTPä»£ç†

download:
  qbittorrent_url: "192.168.1.100"
  qbittorrent_port: 8080
  qbittorrent_username: "admin"
  qbittorrent_password: "password"
  download_dir: "/downloads"

hardlink:
  enable: true
  output_base: "/media/anime"

llm:
  enable: true
  url: "http://localhost:11434/v1/chat/completions"
  name: "deepseek-r1:14b"
  token: "your_api_key"

tmdb_api:
  enabled: true
  api_key: "your_tmdb_api_key"
```

### AIæ¨¡å‹æ”¯æŒ

- **OpenAI Compatible**: æ”¯æŒOpenAI APIæ ¼å¼çš„æ‰€æœ‰LLM
- **Ollama**: æ”¯æŒæœ¬åœ°éƒ¨ç½²çš„å¼€æºæ¨¡å‹
- **DeepSeek**: æ¨èä½¿ç”¨DeepSeek R1ç³»åˆ—æ¨¡å‹
- **å…¶ä»–**: ä»»ä½•æ”¯æŒOpenAI APIæ ¼å¼çš„æ¨¡å‹æœåŠ¡

## ğŸ“– ä½¿ç”¨æŒ‡å—

### æ·»åŠ ä¸‹è½½æº

1. **RSSæºé…ç½®**
   - æ”¯æŒæ ‡å‡†RSSå’ŒAtomæ ¼å¼
   - è‡ªåŠ¨æå–ç£åŠ›é“¾æ¥
   - æ™ºèƒ½ç”Ÿæˆå‰§é›†åŒ¹é…è§„åˆ™

2. **ç£åŠ›é“¾æ¥**
   - ç›´æ¥æ·»åŠ ç£åŠ›é“¾æ¥
   - è‡ªåŠ¨è·å–ç§å­ä¿¡æ¯
   - æ”¯æŒæ‰¹é‡ä¸‹è½½

### åª’ä½“åº“æ•´ç†

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºç¬¦åˆPlex/Emby/Jellyfinæ ‡å‡†çš„æ–‡ä»¶ç»“æ„ï¼š

```
/media/anime/
â”œâ”€â”€ åˆ€å‰‘ç¥åŸŸ/
â”‚   â”œâ”€â”€ Season 1/
â”‚   â”‚   â”œâ”€â”€ åˆ€å‰‘ç¥åŸŸ S01E01.mkv
â”‚   â”‚   â”œâ”€â”€ åˆ€å‰‘ç¥åŸŸ S01E02.mkv
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ Season 2/
â”‚       â”œâ”€â”€ åˆ€å‰‘ç¥åŸŸ S02E01.mkv
â”‚       â””â”€â”€ ...
â””â”€â”€ ä½ çš„åå­—/
    â””â”€â”€ ä½ çš„åå­—.mkv
```

### APIä½¿ç”¨

```python
import requests

# è·å–æ‰€æœ‰æº
response = requests.get("http://localhost:8001/api/source/list")
sources = response.json()

# æ·»åŠ æ–°æº
data = {
    "type": "rss",
    "url": "https://example.com/rss.xml",
    "title": "åŠ¨ç”»åç§°",
    "media_type": "tv",
    "season": 1
}
response = requests.post("http://localhost:8001/api/source/create", json=data)
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
AIAutoBangumi2/
â”œâ”€â”€ api/                    # APIæ¥å£
â”‚   â”œâ”€â”€ auth.py            # ç”¨æˆ·è®¤è¯
â”‚   â”œâ”€â”€ source.py          # æºç®¡ç†
â”‚   â”œâ”€â”€ torrent.py         # ç§å­ç®¡ç†
â”‚   â””â”€â”€ user.py            # ç”¨æˆ·ç®¡ç†
â”œâ”€â”€ core/                  # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ config.py          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ scheduler.py       # å®šæ—¶ä»»åŠ¡
â”‚   â””â”€â”€ sources.py         # æºå¤„ç†
â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ base.py            # åŸºç¡€æ¨¡å‹
â”‚   â”œâ”€â”€ models.py          # æ•°æ®è¡¨å®šä¹‰
â”‚   â””â”€â”€ session.py         # æ•°æ®åº“ä¼šè¯
â”œâ”€â”€ utils/                 # å·¥å…·æ¨¡å—
â”‚   â”œâ”€â”€ ai.py              # AIåŠŸèƒ½
â”‚   â”œâ”€â”€ qbittorrent.py     # qBittorrenté›†æˆ
â”‚   â”œâ”€â”€ rss.py             # RSSå¤„ç†
â”‚   â””â”€â”€ tmdb.py            # TMDBé›†æˆ
â”œâ”€â”€ templates/             # Webæ¨¡æ¿
â”œâ”€â”€ static/                # é™æ€èµ„æº
â””â”€â”€ main.py                # ä¸»ç¨‹åºå…¥å£
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰AIæç¤ºè¯

å¯ä»¥é€šè¿‡ä¿®æ”¹`utils/ai.py`ä¸­çš„æç¤ºè¯æ¥ä¼˜åŒ–AIè¯†åˆ«æ•ˆæœï¼š

```python
# è‡ªå®šä¹‰å‰§é›†è¯†åˆ«æç¤ºè¯
EPISODE_EXTRACTION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŠ¨æ¼«æ–‡ä»¶ååˆ†æåŠ©æ‰‹...
"""
```

### è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼

æ”¯æŒæ‰‹åŠ¨é…ç½®æ­£åˆ™è¡¨è¾¾å¼ä»¥é€‚åº”ç‰¹æ®Šå‘½åæ ¼å¼ï¼š

```python
# ç¤ºä¾‹æ­£åˆ™è¡¨è¾¾å¼
episode_regex = r"ç¬¬(\d+)è¯"  # åŒ¹é…"ç¬¬01è¯"æ ¼å¼
episode_regex = r"EP(\d+)"    # åŒ¹é…"EP01"æ ¼å¼
```

### Webhooké›†æˆ

```python
# ä¸‹è½½å®Œæˆåè‡ªåŠ¨é€šçŸ¥
webhook_url = "https://your-webhook-url.com"
requests.post(webhook_url, json={
    "title": "ä¸‹è½½å®Œæˆ",
    "episode": "ç¬¬01è¯",
    "file_path": "/media/anime/..."
})
```

## ğŸ” åŠŸèƒ½è¯¦è§£

### æ™ºèƒ½å‰§é›†è¯†åˆ«
ç³»ç»Ÿä½¿ç”¨å¤šå±‚è¯†åˆ«æœºåˆ¶ï¼š
1. **AIåˆ†æ**: ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹åˆ†ææ–‡ä»¶å
2. **æ­£åˆ™åŒ¹é…**: åŸºäºç”¨æˆ·é…ç½®æˆ–è‡ªåŠ¨ç”Ÿæˆçš„æ­£åˆ™è¡¨è¾¾å¼
3. **å¤‡ç”¨è§„åˆ™**: å†…ç½®çš„é€šç”¨åŒ¹é…è§„åˆ™

### æ–‡ä»¶é‡è¦æ€§åˆ¤æ–­
AIä¼šè‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼š
- **ä¸»è¦å‰§é›†**: éœ€è¦ä¸‹è½½å’Œç¡¬é“¾æ¥çš„è§†é¢‘æ–‡ä»¶
- **å­—å¹•æ–‡ä»¶**: é…å¥—çš„å­—å¹•æ–‡ä»¶
- **ç‰¹å…¸å†…å®¹**: OP/EDã€ç‰¹åˆ«ç¯‡ç­‰é¢å¤–å†…å®¹
- **å…¶ä»–æ–‡ä»¶**: ä¸é‡è¦çš„æ–‡ä»¶ï¼Œå¯è·³è¿‡å¤„ç†

### ç¡¬é“¾æ¥ç®¡ç†
è‡ªåŠ¨åˆ›å»ºåª’ä½“åº“å‹å¥½çš„æ–‡ä»¶ç»“æ„ï¼š
- æ”¯æŒç”µè§†å‰§å­£åº¦ç®¡ç†
- æ”¯æŒç”µå½±å•æ–‡ä»¶ç®¡ç†  
- è‡ªåŠ¨å‘½åè§„èŒƒåŒ–
- é¿å…é‡å¤æ–‡ä»¶å ç”¨ç©ºé—´

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: AIåŠŸèƒ½ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥LLMé…ç½®
curl -X POST http://localhost:11434/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{"model":"deepseek-r1:14b","messages":[{"role":"user","content":"test"}]}'
```

**Q: qBittorrentè¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥qBittorrent Web UIæ˜¯å¦å¯ç”¨
# ç¡®è®¤ç”¨æˆ·åå¯†ç æ­£ç¡®
# æ£€æŸ¥ç½‘ç»œè¿æ¥
```

**Q: ç¡¬é“¾æ¥åˆ›å»ºå¤±è´¥**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
# ç¡®è®¤ç›®æ ‡ç›®å½•å­˜åœ¨ä¸”å¯å†™
# éªŒè¯æºæ–‡ä»¶å’Œç›®æ ‡åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿ
```

**Q: TMDB APIé™åˆ¶**
```bash
# æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
# ç¡®è®¤è¯·æ±‚é¢‘ç‡ä¸è¶…è¿‡é™åˆ¶
# æ£€æŸ¥ç½‘ç»œä»£ç†è®¾ç½®
```

### æ—¥å¿—è°ƒè¯•

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=DEBUG
python main.py

# æŸ¥çœ‹ç‰¹å®šæ¨¡å—æ—¥å¿—
tail -f logs/scheduler.log
tail -f logs/ai.log
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/JeremyGuo/AIAutoBangumi2.git
cd AIAutoBangumi2

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
uvicorn main:app --reload --host 0.0.0.0 --port 8001
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_ai.py

# ä»£ç è¦†ç›–ç‡
pytest --cov=./ --cov-report=html
```

### ä»£ç é£æ ¼

```bash
# æ ¼å¼åŒ–ä»£ç 
black .
isort .

# æ£€æŸ¥ä»£ç é£æ ¼
flake8 .
mypy .
```

### è´¡çŒ®æµç¨‹

1. **Forkä»“åº“**å¹¶å…‹éš†åˆ°æœ¬åœ°
2. **åˆ›å»ºåˆ†æ”¯**: `git checkout -b feature/your-feature`
3. **ç¼–å†™ä»£ç **å¹¶æ·»åŠ æµ‹è¯•
4. **è¿è¡Œæµ‹è¯•**ç¡®ä¿é€šè¿‡
5. **æäº¤ä»£ç **: `git commit -m "Add your feature"`
6. **æ¨é€åˆ†æ”¯**: `git push origin feature/your-feature`
7. **åˆ›å»ºPR**å¹¶æè¿°å˜æ›´å†…å®¹

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

### æäº¤é—®é¢˜
- ä½¿ç”¨GitHub IssuesæŠ¥å‘ŠBug
- æå‡ºåŠŸèƒ½å»ºè®®å’Œæ”¹è¿›æ„è§
- åˆ†äº«ä½¿ç”¨ç»éªŒå’Œæœ€ä½³å®è·µ

### ä»£ç è´¡çŒ®
1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/æ–°åŠŸèƒ½`)
3. æäº¤æ›´æ”¹ (`git commit -am 'æ·»åŠ æ–°åŠŸèƒ½'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/æ–°åŠŸèƒ½`)
5. åˆ›å»ºPull Request

### æ–‡æ¡£è´¡çŒ®
- æ”¹è¿›READMEå’ŒWikiæ–‡æ¡£
- æ·»åŠ ä½¿ç”¨ç¤ºä¾‹å’Œæ•™ç¨‹
- ç¿»è¯‘æ–‡æ¡£åˆ°å…¶ä»–è¯­è¨€

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„Python Webæ¡†æ¶
- [Vue.js](https://vuejs.org/) - æ¸è¿›å¼JavaScriptæ¡†æ¶
- [qBittorrent](https://www.qbittorrent.org/) - å¼€æºBitTorrentå®¢æˆ·ç«¯
- [TMDB](https://www.themoviedb.org/) - ç”µå½±æ•°æ®åº“API
- [Ollama](https://ollama.ai/) - æœ¬åœ°LLMè¿è¡Œç¯å¢ƒ
- [SQLAlchemy](https://www.sqlalchemy.org/) - Python SQLå·¥å…·åŒ…
- [Pydantic](https://pydantic-docs.helpmanual.io/) - æ•°æ®éªŒè¯åº“

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªâ­Staræ”¯æŒä¸€ä¸‹ï¼**

Made with â¤ï¸ by [JeremyGuo](https://github.com/JeremyGuo)

</div>
